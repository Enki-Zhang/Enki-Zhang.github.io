---
title: 瑞吉外卖项目记录
top: false
cover: false
toc: true
mathjax: true
date: 2022-08-03 14:43:54
password:
summary:
tags:
categories:
---



## 雪花算法的精度丢失问题
发送到服务器中的js如下
![asset_img](瑞吉外卖项目记录/2022-08-03-16-38-47.png)
数据库中的id信息如下
![asset_img](瑞吉外卖项目记录/2022-08-03-16-40-16.png)
js只能确保前十六位的数字是精确的，导致提交的id和数据库中的id不一致。
我们可以在服务器响应页面的json中进行处理，将long型的数据转为String字符串

# 公共字段自动填充如何获得request中的用户信息
通过ThreadLocal来获取，客户端发送的每次http请求中，对应的服务器都会分配一个新的线程来处理，在处理中涉及到下面类中的方法都属于相同的一个线程：
1. LoginCheckFilter的doFilter方法
2. EmployeeController的update方法
3. MyMetaObjectHandler的updateFill方法

可以在上面的三个方法中分别加入如下代码
~~~java
long id = Thread.currentThread().getId();
log.info("线程id：{}", id);
~~~
知道一次请求属于一次线程。ThreadLocal为每个线程提供单独一份存储空间，具有线程隔离的效果，只有在线程内才能获取到对应的值，线程外则不能访问当前线程对应的值

>
~~~java
@DeleteMapping()
    public R<String> deleteCategory( @RequestBody Category category,Long ids){
        log.info("删除分类 {}",category.getId());

        return null;
    }
~~~
@RequestBody获取请求体中的数据并赋予 category 但要获取URL中的参数不能用该注解
